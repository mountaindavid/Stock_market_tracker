# GitHub Actions Workflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
# –≠—Ç–æ—Ç workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ main –≤–µ—Ç–∫—É

name: Deploy to Production

# –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ main –≤–µ—Ç–∫—É
on:
  push:
    branches: [ main ]

# –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
concurrency:
  group: production
  cancel-in-progress: false

jobs:
  # Job –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    # –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥
    - name: Checkout code
      uses: actions/checkout@v4
    
    # –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"
        cache: 'pip'
    
    # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    # –®–∞–≥ 4: –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    - name: Collect static files
      run: |
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏
        export DEBUG=False
        export SECRET_KEY=temp-key-for-build
        export DATABASE_URL=sqlite:///temp.db
        export ALPHA_VANTAGE_API_KEY=demo
        # –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
        python manage.py collectstatic --noinput
    
    # –®–∞–≥ 5: –°–æ–∑–¥–∞–µ–º Docker –æ–±—Ä–∞–∑ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker)
    - name: Build Docker image
      run: |
        # –°–æ–∑–¥–∞–µ–º Docker –æ–±—Ä–∞–∑
        docker build -t stock-market-app:${{ github.sha }} .
        # –¢–µ–≥–∏—Ä—É–µ–º –æ–±—Ä–∞–∑
        docker tag stock-market-app:${{ github.sha }} stock-market-app:latest
    
    # –®–∞–≥ 6: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
    - name: Notify ready for deployment
      run: |
        echo "‚úÖ Build successful!"
        echo "üì¶ Docker image created: stock-market-app:${{ github.sha }}"
        echo "üìä Commit: ${{ github.sha }}"
        echo "üë§ Author: ${{ github.actor }}"
        echo ""
        echo "üöÄ Ready for deployment!"
        echo "üí° To deploy, add SSH secrets and uncomment deployment steps"
    
    # –®–∞–≥ 7: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
    # - name: Deploy to server
    #   uses: appleboy/ssh-action@v1.0.0
    #   with:
    #     host: ${{ secrets.HOST }}
    #     username: ${{ secrets.USERNAME }}
    #     key: ${{ secrets.SSH_KEY }}
    #     port: ${{ secrets.PORT }}
    #     script: |
    #       echo "Deployment script would run here"
    #       echo "Add your deployment commands here" 